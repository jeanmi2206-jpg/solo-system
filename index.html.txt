<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f18" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>SYSTEM ‚Äî Solo IRL</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root{
      --bg:#070a12;
      --panel: rgba(10, 14, 24, .65);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.60);
      --glow: rgba(120, 200, 255, .35);
      --good: rgba(110,255,190,.85);
      --bad: rgba(255,120,130,.85);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(255,255,255,.08), transparent 55%),
        radial-gradient(700px 420px at 80% 25%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, #060812, #020309 55%, #000 100%);
      min-height:100vh;
    }
    .wrap{ max-width:980px; margin:0 auto; padding:16px; padding-bottom:84px; }
    .top{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,.28);
      border-bottom:1px solid var(--border);
    }
    .top-inner{ max-width:980px; margin:0 auto; padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand{ display:flex; gap:12px; align-items:center; }
    .badge{
      width:44px; height:44px; border-radius:16px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
      box-shadow: 0 0 0 1px rgba(255,255,255,.04), 0 0 22px var(--glow);
      display:grid; place-items:center;
      font-weight:800;
      letter-spacing:.18em;
      color: rgba(200,240,255,.92);
    }
    .brand h1{ margin:0; font-size:16px; letter-spacing:.2em; color: var(--muted); }
    .brand .name{ font-size:18px; font-weight:800; letter-spacing:.01em; color:var(--text); margin-top:2px; }
    .row{ display:grid; grid-template-columns: 1.1fr .9fr .9fr; gap:12px; margin-top:14px; }
    .card{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius:22px;
      padding:14px;
      box-shadow: 0 0 0 1px rgba(255,255,255,.04);
    }
    .card h2{ margin:0 0 10px 0; font-size:13px; letter-spacing:.18em; color:var(--muted); text-transform:uppercase; }
    .big{ font-size:28px; font-weight:900; }
    .sub{ color:var(--muted); font-size:13px; }
    .bar{ height:10px; border-radius:99px; background: rgba(255,255,255,.08); overflow:hidden; border:1px solid rgba(255,255,255,.08); }
    .bar > div{ height:100%; width:30%; background: rgba(255,255,255,.75); box-shadow: 0 0 18px var(--glow); }
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:12px;
    }
    .tab{
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight:700;
      cursor:pointer;
    }
    .tab.active{ background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.16); }
    .actions{ display:flex; gap:10px; align-items:center; }
    button.primary{
      padding:11px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.14);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
    }
    button.ghost{
      width:44px; height:44px; border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      border-radius:18px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      padding:12px;
      display:flex; justify-content:space-between; gap:10px;
    }
    .item .title{ font-weight:900; }
    .pills{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .pill{
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      font-weight:700;
    }
    .btn{
      padding:10px 12px; border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.08);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .danger{ border-color: rgba(255,120,130,.25); background: rgba(255,120,130,.10); }
    .ok{ border-color: rgba(110,255,190,.25); background: rgba(110,255,190,.12); }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .stat{
      border-radius:18px; border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      padding:12px;
    }
    .stat .k{ color:var(--muted); font-size:12px; letter-spacing:.12em; text-transform:uppercase; }
    .stat .v{ font-size:24px; font-weight:900; margin-top:6px; }
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,.72); padding:16px; z-index:50;
    }
    .modal.open{ display:flex; }
    .modal .box{
      width:min(720px, 94vw);
      background: rgba(10,14,24,.92);
      border:1px solid rgba(255,255,255,.14);
      border-radius:24px;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal .head{
      padding:14px 16px; display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid var(--border);
    }
    .modal .body{ padding:16px; }
    label{ display:block; color:var(--muted); font-size:12px; letter-spacing:.12em; text-transform:uppercase; margin-top:12px; }
    input, select{
      width:100%; margin-top:8px;
      height:44px; border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:0 12px;
      outline:none;
    }
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; width:min(520px, 92vw);
      display:none; z-index:60;
    }
    .toast.show{ display:block; }
    .toast .tbox{
      border-radius:18px;
      background: rgba(0,0,0,.70);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(10px);
      padding:12px 14px;
      display:flex; justify-content:space-between; gap:12px;
    }
    .footnote{ color:var(--muted); font-size:12px; margin-top:10px; }
    @media (max-width: 860px){
      .row{ grid-template-columns:1fr; }
      .grid2{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <div class="top">
    <div class="top-inner">
      <div class="brand">
        <div class="badge">SY</div>
        <div>
          <h1>SYSTEM</h1>
          <div class="name"><span id="playerName">Hunter</span> ‚Ä¢ <span id="rankName">√âveill√©</span></div>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="btnNewQuest">+ Mission</button>
        <button class="ghost" id="btnSettings" title="Param√®tres">‚öô</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="row">
      <div class="card">
        <h2>Niveau</h2>
        <div style="display:flex; align-items:baseline; justify-content:space-between; gap:10px;">
          <div class="big">NIV <span id="level">1</span></div>
          <div class="sub"><span id="xpInto">0</span> / <span id="xpNext">100</span> XP</div>
        </div>
        <div style="margin-top:12px;" class="bar"><div id="xpBar"></div></div>
        <div class="footnote">Valide une mission = XP + bonus de stat</div>
      </div>

      <div class="card">
        <h2>√ânergie</h2>
        <div class="big"><span id="energy">60</span>%</div>
        <div style="margin-top:12px;" class="bar"><div id="energyBar"></div></div>
        <div class="footnote">Bas√© sur Endurance + s√©ries</div>
      </div>

      <div class="card">
        <h2>Aujourd‚Äôhui</h2>
        <div class="big"><span id="doneCount">0</span>/<span id="allCount">0</span></div>
        <div class="sub" style="margin-top:6px;">Missions valid√©es ‚Ä¢ <span id="todayLabel"></span></div>
        <div class="footnote">Les ‚ÄúDaily‚Äù sont faites 1 fois par jour</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="system">Syst√®me</button>
      <button class="tab" data-tab="missions">Missions</button>
      <button class="tab" data-tab="statut">Statut</button>
      <button class="tab" data-tab="inventaire">Inventaire</button>
      <button class="tab" data-tab="journal">Journal</button>
    </div>

    <div id="view-system" style="margin-top:14px;">
      <div class="grid2">
        <div class="card">
          <h2>Missions (aujourd‚Äôhui)</h2>
          <div class="list" id="todayList"></div>
        </div>
        <div class="card">
          <h2>Statut rapide</h2>
          <div class="grid2" id="quickStats"></div>
        </div>
      </div>
    </div>

    <div id="view-missions" style="display:none; margin-top:14px;">
      <div class="card">
        <h2>Toutes les missions</h2>
        <div class="list" id="allMissions"></div>
      </div>
    </div>

    <div id="view-statut" style="display:none; margin-top:14px;">
      <div class="grid2">
        <div class="card">
          <h2>Statut</h2>
          <div id="statControls"></div>
          <div class="footnote">Tu peux ajuster manuellement pour refl√©ter ton ressenti.</div>
        </div>
        <div class="card">
          <h2>Total</h2>
          <div class="big"><span id="xpTotal">0</span> XP</div>
          <div class="sub" style="margin-top:8px;">Rang calcul√© automatiquement via le niveau.</div>
        </div>
      </div>
    </div>

    <div id="view-inventaire" style="display:none; margin-top:14px;">
      <div class="grid2">
        <div class="card">
          <h2>Inventaire</h2>
          <div class="list" id="invList"></div>
        </div>
        <div class="card">
          <h2>Ajouter un objet</h2>
          <label>Nom</label>
          <input id="invName" placeholder="Ex: Ceinture lombaire" />
          <label>Note</label>
          <input id="invNote" placeholder="Ex: Squat lourd" />
          <div style="margin-top:14px; display:flex; gap:10px;">
            <button class="btn ok" id="btnAddInv">Ajouter</button>
          </div>
          <div class="footnote">Sauvegard√© sur ton iPhone (localStorage).</div>
        </div>
      </div>
    </div>

    <div id="view-journal" style="display:none; margin-top:14px;">
      <div class="card">
        <h2>Journal</h2>
        <div id="logList"></div>
      </div>
    </div>
  </div>

  <!-- MODAL: NEW QUEST -->
  <div class="modal" id="modalQuest">
    <div class="box">
      <div class="head">
        <div style="font-weight:900; letter-spacing:.08em;">Nouvelle mission</div>
        <button class="ghost" id="closeQuest">‚úï</button>
      </div>
      <div class="body">
        <div class="grid2">
          <div>
            <label>Type</label>
            <select id="qType">
              <option value="daily">Daily (quotidien)</option>
              <option value="mission">Mission</option>
            </select>
            <label>Titre</label>
            <input id="qTitle" placeholder="Ex: S√©ance jambes (squat)" />
            <label>XP</label>
            <input id="qXP" type="number" min="5" max="500" value="25" />
          </div>
          <div>
            <label>Stat r√©compense</label>
            <select id="qStat">
              <option value="force">force</option>
              <option value="agilite">agilite</option>
              <option value="vitalite">vitalite</option>
              <option value="intelligence">intelligence</option>
              <option value="endurance">endurance</option>
            </select>
            <label>Montant</label>
            <input id="qAmt" type="number" min="1" max="10" value="1" />
            <div class="footnote" style="margin-top:14px;">
              XP conseill√© : 10 (mini) ‚Ä¢ 25 (simple) ‚Ä¢ 50 (moyen) ‚Ä¢ 80‚Äì120 (dur) ‚Ä¢ 200+ (gros objectif)
            </div>
          </div>
        </div>
        <div style="margin-top:16px; display:flex; justify-content:flex-end; gap:10px;">
          <button class="btn" id="cancelQuest">Annuler</button>
          <button class="btn ok" id="saveQuest">Ajouter</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: SETTINGS -->
  <div class="modal" id="modalSettings">
    <div class="box">
      <div class="head">
        <div style="font-weight:900; letter-spacing:.08em;">Param√®tres</div>
        <button class="ghost" id="closeSettings">‚úï</button>
      </div>
      <div class="body">
        <div class="grid2">
          <div class="card" style="padding:14px; margin:0;">
            <h2>Profil</h2>
            <label>Nom</label>
            <input id="setName" placeholder="Ton pseudo" />
            <div class="footnote">Le rang est automatique (niveau).</div>
          </div>
          <div class="card" style="padding:14px; margin:0;">
            <h2>Danger zone</h2>
            <div class="sub">Reset supprime tout sur cet appareil.</div>
            <div style="margin-top:14px;">
              <button class="btn danger" id="btnReset">R√©initialiser tout</button>
            </div>
          </div>
        </div>
        <div style="margin-top:16px; display:flex; justify-content:flex-end;">
          <button class="btn" id="closeSettings2">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="tbox">
      <div>
        <div style="font-weight:900;" id="toastTitle">SYSTEM</div>
        <div class="sub" id="toastDetail"></div>
      </div>
      <button class="ghost" id="toastClose">‚úï</button>
    </div>
  </div>

<script>
/* =======================
   DATA + HELPERS
======================= */
const LS = "slirl_pwa_v1";
const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
const uid = ()=>Math.random().toString(16).slice(2)+Date.now().toString(16);

function todayKey(){
  const d=new Date();
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}
function formatDateLabel(iso){
  try{
    const d=new Date(iso+"T00:00:00");
    return d.toLocaleDateString(undefined,{weekday:"short",day:"2-digit",month:"short"});
  }catch{ return iso; }
}
function xpNeedForLevel(level){ return 100 + (level-1)*20; }
function levelFromXP(total){
  let lvl=1, xp=total, need=100;
  while(xp>=need){ xp-=need; lvl++; need=xpNeedForLevel(lvl); }
  return { level:lvl, xpInto:xp, xpNext:xpNeedForLevel(lvl) };
}
function badgeForLevel(level){
  if(level>=50) return "Monarque";
  if(level>=30) return "Chasseur S";
  if(level>=20) return "Chasseur A";
  if(level>=10) return "Chasseur B";
  return "√âveill√©";
}

const defaultState = {
  profile:{ name:"Hunter" },
  totalXP:0,
  stats:{ force:10, agilite:10, vitalite:10, intelligence:10, endurance:10 },
  inventory:[
    { id:uid(), name:"Montre connect√©e", note:"Suivi cardio / pas" },
    { id:uid(), name:"Halt√®res", note:"Force / hypertrophie" }
  ],
  quests:[
    { id:uid(), type:"daily", title:"Entra√Ænement (20‚Äì45 min)", xp:35, stat:{key:"endurance", amt:1}, doneOn:{}, streak:0, lastDone:null },
    { id:uid(), type:"daily", title:"Marche / course (2‚Äì3 km)", xp:25, stat:{key:"vitalite", amt:1}, doneOn:{}, streak:0, lastDone:null },
    { id:uid(), type:"mission", title:"Planifier investissement mensuel ETF", xp:50, stat:{key:"intelligence", amt:1}, doneOn:{}, streak:0, lastDone:null }
  ],
  log:[],
  meta:{ lastDay: todayKey() }
};

function load(){
  try{
    const raw = localStorage.getItem(LS);
    if(!raw) return structuredClone(defaultState);
    const s = JSON.parse(raw);
    return {
      ...structuredClone(defaultState),
      ...s,
      profile:{...defaultState.profile, ...(s.profile||{})},
      stats:{...defaultState.stats, ...(s.stats||{})},
      meta:{...defaultState.meta, ...(s.meta||{})},
    };
  }catch{
    return structuredClone(defaultState);
  }
}
function save(){ localStorage.setItem(LS, JSON.stringify(state)); }

let state = load();
const today = todayKey();

function dailyRollover(){
  if(state.meta.lastDay !== today){
    state.meta.lastDay = today;
    state.log.unshift({ id:uid(), ts:Date.now(), title:"Nouveau jour d√©tect√©", detail:"Reset quotidien ("+formatDateLabel(today)+")" });
    state.log = state.log.slice(0,80);
    save();
  }
}
dailyRollover();

/* =======================
   UI HELPERS
======================= */
const $ = (id)=>document.getElementById(id);

function toast(title, detail=""){
  $("toastTitle").textContent = title;
  $("toastDetail").textContent = detail;
  $("toast").classList.add("show");
  clearTimeout(toast._t);
  toast._t = setTimeout(()=> $("toast").classList.remove("show"), 3400);
}
$("toastClose").onclick = ()=> $("toast").classList.remove("show");

function switchTab(tab){
  document.querySelectorAll(".tab").forEach(b=>b.classList.toggle("active", b.dataset.tab===tab));
  ["system","missions","statut","inventaire","journal"].forEach(t=>{
    $("view-"+t).style.display = (t===tab) ? "block":"none";
  });
  render();
}
document.querySelectorAll(".tab").forEach(b=> b.onclick=()=>switchTab(b.dataset.tab));

/* =======================
   GAME LOGIC
======================= */
function energyValue(){
  const base = clamp(45 + (state.stats.endurance||10)*2, 0, 100);
  const dailyStreakSum = (state.quests||[]).filter(q=>q.type==="daily").reduce((a,q)=>a+(q.streak||0),0);
  return clamp(base + Math.floor(dailyStreakSum/5), 0, 100);
}
function yesterdayKey(){
  const d = new Date();
  d.setDate(d.getDate()-1);
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}

function completeQuest(id){
  const q = state.quests.find(x=>x.id===id);
  if(!q) return;
  if(q.doneOn?.[today]) return;

  q.doneOn = {...(q.doneOn||{}), [today]: true};

  const y = yesterdayKey();
  q.streak = (q.lastDone===y) ? (q.streak||0)+1 : 1;
  q.lastDone = today;

  state.totalXP += (q.xp||0);
  const k = q.stat?.key;
  const a = q.stat?.amt||0;
  if(k && typeof state.stats[k]==="number") state.stats[k]+=a;

  state.log.unshift({ id:uid(), ts:Date.now(), title:"Mission valid√©e", detail:`+${q.xp} XP ‚Ä¢ +${a} ${k} ‚Ä¢ ${q.title}` });
  state.log = state.log.slice(0,80);
  save();
  toast("OBJECTIF ACCOMPLI", `+${q.xp} XP ‚Ä¢ ${q.title}`);
  render();
}

function removeQuest(id){
  state.quests = state.quests.filter(q=>q.id!==id);
  state.log.unshift({ id:uid(), ts:Date.now(), title:"Mission supprim√©e", detail:`ID: ${id}` });
  state.log = state.log.slice(0,80);
  save();
  render();
}

function addQuest({type,title,xp,statKey,statAmt}){
  title = title.trim();
  if(!title){ toast("Champ manquant","Donne un nom √† ta mission."); return; }
  xp = clamp(Number(xp)||0, 5, 500);
  statAmt = clamp(Number(statAmt)||1, 1, 10);

  state.quests.unshift({
    id:uid(),
    type,
    title,
    xp,
    stat:{ key:statKey, amt:statAmt },
    doneOn:{}, streak:0, lastDone:null
  });
  state.log.unshift({ id:uid(), ts:Date.now(), title:"Nouvelle mission", detail:`${type} ‚Ä¢ ${title} (+${xp} XP)` });
  state.log = state.log.slice(0,80);
  save();
  toast("MISSION AJOUT√âE", title);
  render();
}

function tweakStat(key, delta){
  state.stats[key] = clamp((state.stats[key]||0)+delta, 0, 999);
  save(); render();
}

function addInv(name, note){
  name = (name||"").trim();
  note = (note||"").trim();
  if(!name) return;
  state.inventory.unshift({ id:uid(), name, note });
  save(); render();
  toast("OBJET AJOUT√â", name);
}
function removeInv(id){
  state.inventory = state.inventory.filter(x=>x.id!==id);
  save(); render();
}

function resetAll(){
  if(!confirm("R√©initialiser TOUT ? (XP, stats, missions, inventaire)")) return;
  state = structuredClone(defaultState);
  state.inventory = [];
  state.quests = [];
  state.log = [{ id:uid(), ts:Date.now(), title:"Reset", detail:"Syst√®me r√©initialis√©." }];
  state.meta.lastDay = todayKey();
  save();
  toast("RESET","Syst√®me r√©initialis√©");
  render();
}

/* =======================
   RENDER
======================= */
function questHTML(q){
  const done = !!q.doneOn?.[today];
  const pill = (txt)=>`<span class="pill">${txt}</span>`;
  return `
    <div class="item">
      <div style="min-width:0;">
        <div class="title">${escapeHtml(q.title)}</div>
        <div class="pills">
          ${pill(`+${q.xp} XP`)}
          ${pill(`S√©rie: ${q.streak||0}`)}
          ${pill(`+${q.stat.amt} ${q.stat.key}`)}
          ${pill(q.type==="daily" ? "Daily" : "Mission")}
        </div>
      </div>
      <div style="display:flex; gap:8px; align-items:flex-start;">
        <button class="btn danger" onclick="removeQuest('${q.id}')" title="Supprimer">üóë</button>
        <button class="btn ${done ? "" : "ok"}" ${done ? "disabled":""} onclick="completeQuest('${q.id}')">
          ${done ? "Fait" : "Valider"}
        </button>
      </div>
    </div>
  `;
}
function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
}

function render(){
  const lv = levelFromXP(state.totalXP||0);
  const rank = badgeForLevel(lv.level);
  $("playerName").textContent = state.profile.name || "Hunter";
  $("rankName").textContent = rank;

  $("level").textContent = lv.level;
  $("xpInto").textContent = lv.xpInto;
  $("xpNext").textContent = lv.xpNext;
  $("xpTotal").textContent = state.totalXP||0;

  const xpPct = lv.xpNext ? clamp((lv.xpInto/lv.xpNext)*100,0,100) : 0;
  $("xpBar").style.width = xpPct + "%";

  const e = energyValue();
  $("energy").textContent = e;
  $("energyBar").style.width = e + "%";

  $("todayLabel").textContent = formatDateLabel(today);

  const doneCount = (state.quests||[]).filter(q=>q.doneOn?.[today]).length;
  $("doneCount").textContent = doneCount;
  $("allCount").textContent = (state.quests||[]).length;

  $("todayList").innerHTML = (state.quests||[]).slice(0,6).map(questHTML).join("") || `<div class="sub">Aucune mission. Clique sur ‚Äú+ Mission‚Äù.</div>`;
  $("allMissions").innerHTML = (state.quests||[]).map(questHTML).join("") || `<div class="sub">Aucune mission.</div>`;

  // quick stats
  $("quickStats").innerHTML = Object.entries(state.stats||{}).map(([k,v])=>`
    <div class="stat">
      <div class="k">${k}</div>
      <div class="v">${v}</div>
    </div>
  `).join("");

  // stat controls
  $("statControls").innerHTML = Object.keys(state.stats||{}).map((k)=>`
    <div class="item" style="align-items:center;">
      <div>
        <div class="title">${k}</div>
        <div class="sub">Ajustement manuel</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn" onclick="tweakStat('${k}',-1)">‚àí</button>
        <div style="width:52px; text-align:center; font-weight:900;">${state.stats[k]}</div>
        <button class="btn ok" onclick="tweakStat('${k}',1)">+</button>
      </div>
    </div>
  `).join("");

  // inventory
  $("invList").innerHTML = (state.inventory||[]).map(it=>`
    <div class="item">
      <div style="min-width:0;">
        <div class="title">${escapeHtml(it.name)}</div>
        <div class="sub">${escapeHtml(it.note||"")}</div>
      </div>
      <button class="btn danger" onclick="removeInv('${it.id}')">üóë</button>
    </div>
  `).join("") || `<div class="sub">Inventaire vide.</div>`;

  // log
  $("logList").innerHTML = (state.log||[]).map(it=>`
    <div style="padding:12px 0; border-bottom:1px solid rgba(255,255,255,.10);">
      <div style="font-weight:900;">${escapeHtml(it.title)}</div>
      <div class="sub">${escapeHtml(it.detail||"")}</div>
      <div class="sub" style="margin-top:4px; opacity:.75;">${new Date(it.ts).toLocaleString()}</div>
    </div>
  `).join("") || `<div class="sub">Aucune entr√©e.</div>`;

  // settings
  $("setName").value = state.profile.name || "";
}

render();

/* =======================
   MODALS + BUTTONS
======================= */
const modalQuest = $("modalQuest");
const modalSettings = $("modalSettings");

$("btnNewQuest").onclick = ()=> modalQuest.classList.add("open");
$("closeQuest").onclick = ()=> modalQuest.classList.remove("open");
$("cancelQuest").onclick = ()=> modalQuest.classList.remove("open");

$("btnSettings").onclick = ()=> { modalSettings.classList.add("open"); $("setName").value = state.profile.name || ""; };
$("closeSettings").onclick = ()=> modalSettings.classList.remove("open");
$("closeSettings2").onclick = ()=> modalSettings.classList.remove("open");

$("saveQuest").onclick = ()=>{
  addQuest({
    type: $("qType").value,
    title: $("qTitle").value,
    xp: $("qXP").value,
    statKey: $("qStat").value,
    statAmt: $("qAmt").value,
  });
  $("qTitle").value = "";
  $("qXP").value = 25;
  $("qAmt").value = 1;
  modalQuest.classList.remove("open");
};

$("setName").addEventListener("input", (e)=>{
  state.profile.name = e.target.value;
  save(); render();
});

$("btnReset").onclick = ()=> { resetAll(); modalSettings.classList.remove("open"); };

$("btnAddInv").onclick = ()=>{
  addInv($("invName").value, $("invNote").value);
  $("invName").value=""; $("invNote").value="";
};

/* =======================
   SERVICE WORKER
======================= */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => navigator.serviceWorker.register("./service-worker.js").catch(()=>{}));
}
</script>
</body>
</html>
